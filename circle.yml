dependencies:
  override:
    - docker rm -rf api
    - docker build -t psesd/ssl-api:develop .

test:
  override:
    - docker run -d --name api --link redis:redis -p 104.192.103.12:443:443 -e "NODE_ENV=development" -e "NODE_CONFIG_DIR=/config" -v /config:/config psesd/ssl-api:develop; sleep 10
    - curl --retry 10 --retry-delay 5 -v https://api.cbo.upward.st

deployment:
  push_to_server:
    branch: develop
    commands:
      - git pull --all circleci@104.192.103.11:/home/cbo/docker/api
  hub:
    branch: develop
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push psesd/ssl-api:develop